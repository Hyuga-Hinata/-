# 为非易失性主存储器组合生存期增强技术

# Composing lifetime enhancing techniques for non-volatile main memories



## 摘要

优点：高密度，低功耗、低成本

缺点：写续航时间

三种技术延长NVM生命： 最后一层缓存替换策略、<font color = 'red'>压缩和NVM损耗均衡。</font>



CCS:电脑系统组织-->体系结构；硬件-->通讯硬件、接口和存储

## 关键词

NVM、缓存替换策略、缓存压缩、损耗平衡、耐久性



## 1. 介绍

相变存储器(PCM)、电阻存储器(ReRAM)  字节寻址类似DRAM

DRAM单元可以被写入大约$10^1$$^6$次，而PCM和ReRAM的写入耐久度在$10^6$-$10^8$之间

缓存替换策略、缓存压缩和损耗均衡,并与最近最少使用（LRU）比较



写入减少不会等效转换为寿命。三项技术联合使用时其复合效果会减弱。

最好的是损耗均衡。



LLC：三级缓存



## 2. 评估方法的相关工作

写抑制： 有的用与基线的比较，有的用权重     但写抑制并不能直接转换成生命提升，因为不均匀写会增加特定位置的损耗

损耗平衡：用不同粒度的写操作来评估    不足以评估其他组件（缓存）对方案的影响



我们工作：从模拟记忆系统中收集大量消息，为任何技术提供完整的影响视图，也同样模拟了对于同一系统的多种技术来观察在实际工作负载下它们如何影响NVM的生命周期。



## 3. 增加NVM生存期的技术

分类：[写入抑制（减少）](缓存压缩和替换策略等，如非易失性双内联内存模块(NVDIMM)中使用DRAM缓存)、损耗均衡

### 3.1 缓存替换策略

提高[缓存](CPU和主存中间的)的命中率

在片上LLC中评估替换方案，并要求方法在那里运行（usually L2 or L3)

缓存替换策略需考虑有价值的指标，不只只是时间。

Clean-first LRU（CFLRU)考虑缓存线的clean or dirty状态和时间，并将缓存划分为预定义的、固定大小的区域：[working](普通的LRU缓存) and [clear-first](类似写缓冲区)。

LRU写序列重排序(LRU-WSR): 将脏缓存标记为冷或热。将脏线迁移到最近使用（MRU）位置并选择驱逐冷线或干净线。

冷清理优先LRU(CCF-LRU)考虑clean和dirty缓存的冷热状态来优化LRU-WSR和CFLRU。为dirty和hot clean准备了一个list，为cold clean准备了单独的list。后者优先驱逐，然后前者。

自适应页面替换算法（APPA）：cache分为两扇区（CFLRU和[ghost](只保留缓存线标记和另一个扇区被移除的脏标记)）学习规则在运行时调整扇区大小，在经常写入数据时减少清除脏缓存线的概率而不影响miss rate。

但，这些方案都不一定能运行在Silicon中。但是LLCs的替换策略在时间关键路径之外运行，可以使用更复杂的替换方案。



### 3.2 缓存压缩

压缩：不需要添加实际上内存单元而增加缓存[有效大小](总未压缩大小)

要求： 无损、低功耗、低面积，不能降低缓存性能，压缩比尽可能大，数据可以以未压缩的缓存线的粒度随机访问

零内容扩展缓存（ZC）、频繁模式压缩（FPC）、频繁值编码（FVE）、C-Pack

有效缓存大小提高 ： 1.5-2.5

### 3.3 损耗平衡

直接应用于主存

通常通过逻辑地址到物理地址的间接表来实现磨损均衡，额外的表来追踪储存块的写计数，并将后面的写操作路由到很少写的位置。

Rejuvenator: 识别并定期迁移很少写入的逻辑地址，来释放最少写入的物理地址。

行移动： 读取内存块与待写数据比较，只改变不同的值。 --> 行写入数量不均匀，定期移位。

cache line 在虚拟页的边界内定期的旋转，确保设备均匀损耗。

Start-Gap: 逻辑与物理地址之间的代数映射。

## 4. 方法

收集与缓存（cache）相关的数据和在整个进程中跨内存层次的通信量

### 4.1 实验装置

gem5   模拟一个或多个计算机系统。

本例：64位ARM系统上的服务器工作负载    LLC性能以及从LLC到主存的读写访问的容量和位置   简化其他组件，减少仿真时间

为避免引入虚拟页交换带来的噪声， 主存大小为16GB，远远大于任何工作负载的内存。

### 4.2 模拟和离线数据

数据收集和分析过程：[在线](gem5中所进行的数据采集,包括但不限于缓存线丢失，命中率，随时间变化的脏缓存和缓存线利用率)和离线

操作的虚拟地址被解析之后，从LLC收集到主内存的[读写内存访问跟踪](访问时间，物理内存地址、大小和类型（读或写）)

CFLRU/LRU-WSR/CCF-LRU/APRA/LRU(基线)

最后，为了估计磨损均衡技术的影响，模拟跟踪中描述的对具有某种磨损均衡方案的主内存设备的访问，我们将内存大小减少到比工作负载的内存大200MB.

### 4.3 工作负荷

Ubuntu 14.04 LTS   Memcached Server-Side Java(SS)   PageRank  [Forest-fire](fordward： 0.3  backword: 0.25)     包括数据库缓存和图形处理

## 5. 结果

### 5.1 量化持久性问题

NVM生命周期：第一次使用到第一次故障之间的时间间隔。     >5年

### 5.2 写流量的属性

Forest-fire/Memcached  写密集型工作负载 读写访问比例1：1

### 5.3 LRU缓存配置和写入流量

当关联性增加到一个阈值以上时，由于冲突缺失而导致的驱逐将减少到最低限度，并且不会对写流量产生显著影响。

LLC越大，写流量减少，但不足。

### 5.4 缓存替换策略

与LRU相比，丢失率变化很小，写流量减少低于10%

CCF-LRU对大量写阶段工作负载而言效果显著。

### 5.5 缓存压缩

弱，垃圾，排除它

### 5.6 损耗平衡

完美磨损均衡（理想）、基本磨损均衡

LifetimeInSecs = [MemEndurance](NVM技术的持久性因素) / [WritePerSec](每秒每个内存位置的理想写操作数)

overprovisioning 增加内存容量技术，不讨论。

<font color = 'red'>lifetime increase factor</font> ? p9

<font color = 'red'>为什么完美算法中的静态数据经常迁移还能比基本算法好？</font> p9



### 5.7 结合技术

磨损均衡技术提高至少两个数量级，最有效。

缓存替换大约一个数量级，大约是缓存压缩的两倍。

## 6. 未来工作

NVDIMMs中的DRAM缓存可以用来捕获写操作。

使用DRAM缓存探索替换策略和缓存压缩方案。

DRAM缓存由操作系统或应用程序直接管理，以更大（页面大小）粒度为代价，研究更复杂和特定于应用程序的策略。

## 7. 结论

内存占用明显大于片上缓存的大小

图形工作负载的不规则访问模式，使得缓存可用信息有限的情况下更难抑制写操作。

写访问不均匀。

缓存替换策略：写流量减少约10%      12天到6个月

压缩：   写操作减少15%     12天到2个月

磨损均衡方案：    主要障碍：工作负载很少写入静态位置。因为数据很少回写，位置就不会被耗尽，算法的操作空间也就更小。     12天到15年



损耗均衡技术必不可少。